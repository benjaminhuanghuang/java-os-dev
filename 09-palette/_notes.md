
# Hello OS
[使用调色板绘制系统界面](https://blog.csdn.net/tyler_download/article/details/52556502)

https://www.bilibili.com/video/BV1hJ411n7rs?p=9

上一节，我们实现图像绘制的办法是，给每一个像素设定指定的数值，这个数值只能位于0-256这个范畴，以现在绚丽多彩的UI效果来说，256种颜色显然是不够用的，而且还不论颜色的亮度，饱和度等这些成分呢。

能够比较好的表示颜色的，一般都使用RGB模式，表示一个RGB颜色需要24位数，原先我们使用的八位数，显然不能满足要求，为了在八位数下使用RGB模式色彩模式，需要使用调色板系统。

调色板系统就是把多种RGB颜色的24位数值放入到一个数组中，原来的八位数不再对应一个颜色值，而是变成这个数组的下标，硬件在显示像素颜色时，从像素对应的显存读取这个八位数，然后把这个数当做下标，在RGB颜色素组中找到对应的RGB颜色值，再把这个颜色值显示到对应的像素上。


## VGA to Palette
要想使得显存系统将颜色的显示模式转换成调色板模式， 需要读写Port。C语言无法直接操作硬件，因此，写入和读取端口的代码需要汇编语言来完成

根据C语言的调用规定，如果函数有返回值，那么返回值必须存储在寄存器al,ah, 或ax, eax中，因此这些ASM函数从端口读出的数据都会被存储到寄存器al, 或ax中。

在进行端口设定的时候，需要关闭中断信号的发生机制，以避免CPU被干扰， 这需要操作 EFLAGES 寄存器（16位）
中断功能对应该寄存器的第9位，第9位如果设置为1，那么中断功能就会被打开，如果设置为0，中断功能就会被关闭。
CLI指令实际上，就是通过把这个寄存器的第9位设置成0，从而实现禁止中断功能的。

步骤如下
1. 关闭中断，防止CPU被干扰
2. 将调色板的号码写入端口0x03c8, 如果只有一个调色板，因此调色板的编号默认为0，如果要设置多个调色板，那么其他调色板的编号依次为1，2…等
3. 将RGB的颜色数值依次写入端口0x3c9, 假设我们要写入的RGB颜色值是 0x848484 那么在C语言中，要分3次调用io_out8, 






